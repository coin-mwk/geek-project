{"ast":null,"code":"import { useTouch } from './use-touch';\nimport { useEffect } from 'react';\nimport { getScrollParent } from './get-scroll-parent';\nimport { supportsPassive } from './supports-passive';\nlet totalLockCount = 0;\nconst BODY_LOCK_CLASS = 'adm-overflow-hidden';\n\nfunction getScrollableElement(el) {\n  let current = el === null || el === void 0 ? void 0 : el.parentElement;\n\n  while (current) {\n    if (current.clientHeight < current.scrollHeight) {\n      return current;\n    }\n\n    current = current.parentElement;\n  }\n\n  return null;\n} // 移植自vant：https://github.com/youzan/vant/blob/HEAD/src/composables/use-lock-scroll.ts\n\n\nexport function useLockScroll(rootRef, shouldLock) {\n  const touch = useTouch();\n\n  const onTouchMove = event => {\n    touch.move(event);\n    const direction = touch.deltaY.current > 0 ? '10' : '01';\n    const el = getScrollParent(event.target, rootRef.current);\n    if (!el) return; // This has perf cost but we have to compatible with iOS 12\n\n    if (shouldLock === 'strict') {\n      const scrollableParent = getScrollableElement(event.target);\n\n      if (scrollableParent === document.body || scrollableParent === document.documentElement) {\n        event.preventDefault();\n        return;\n      }\n    }\n\n    const {\n      scrollHeight,\n      offsetHeight,\n      scrollTop\n    } = el;\n    let status = '11';\n\n    if (scrollTop === 0) {\n      status = offsetHeight >= scrollHeight ? '00' : '01';\n    } else if (scrollTop + offsetHeight >= scrollHeight) {\n      status = '10';\n    }\n\n    if (status !== '11' && touch.isVertical() && !(parseInt(status, 2) & parseInt(direction, 2))) {\n      if (event.cancelable) {\n        event.preventDefault();\n      }\n    }\n  };\n\n  const lock = () => {\n    document.addEventListener('touchstart', touch.start);\n    document.addEventListener('touchmove', onTouchMove, supportsPassive ? {\n      passive: false\n    } : false);\n\n    if (!totalLockCount) {\n      document.body.classList.add(BODY_LOCK_CLASS);\n    }\n\n    totalLockCount++;\n  };\n\n  const unlock = () => {\n    if (totalLockCount) {\n      document.removeEventListener('touchstart', touch.start);\n      document.removeEventListener('touchmove', onTouchMove);\n      totalLockCount--;\n\n      if (!totalLockCount) {\n        document.body.classList.remove(BODY_LOCK_CLASS);\n      }\n    }\n  };\n\n  useEffect(() => {\n    if (shouldLock) {\n      lock();\n      return () => {\n        unlock();\n      };\n    }\n  }, [shouldLock]);\n}","map":{"version":3,"names":["useTouch","useEffect","getScrollParent","supportsPassive","totalLockCount","BODY_LOCK_CLASS","getScrollableElement","el","current","parentElement","clientHeight","scrollHeight","useLockScroll","rootRef","shouldLock","touch","onTouchMove","event","move","direction","deltaY","target","scrollableParent","document","body","documentElement","preventDefault","offsetHeight","scrollTop","status","isVertical","parseInt","cancelable","lock","addEventListener","start","passive","classList","add","unlock","removeEventListener","remove"],"sources":["/Users/tonystark/code/VSCodeProject/react/gk-h5/node_modules/antd-mobile/es/utils/use-lock-scroll.js"],"sourcesContent":["import { useTouch } from './use-touch';\nimport { useEffect } from 'react';\nimport { getScrollParent } from './get-scroll-parent';\nimport { supportsPassive } from './supports-passive';\nlet totalLockCount = 0;\nconst BODY_LOCK_CLASS = 'adm-overflow-hidden';\nfunction getScrollableElement(el) {\n  let current = el === null || el === void 0 ? void 0 : el.parentElement;\n  while (current) {\n    if (current.clientHeight < current.scrollHeight) {\n      return current;\n    }\n    current = current.parentElement;\n  }\n  return null;\n}\n// 移植自vant：https://github.com/youzan/vant/blob/HEAD/src/composables/use-lock-scroll.ts\nexport function useLockScroll(rootRef, shouldLock) {\n  const touch = useTouch();\n  const onTouchMove = event => {\n    touch.move(event);\n    const direction = touch.deltaY.current > 0 ? '10' : '01';\n    const el = getScrollParent(event.target, rootRef.current);\n    if (!el) return;\n    // This has perf cost but we have to compatible with iOS 12\n    if (shouldLock === 'strict') {\n      const scrollableParent = getScrollableElement(event.target);\n      if (scrollableParent === document.body || scrollableParent === document.documentElement) {\n        event.preventDefault();\n        return;\n      }\n    }\n    const {\n      scrollHeight,\n      offsetHeight,\n      scrollTop\n    } = el;\n    let status = '11';\n    if (scrollTop === 0) {\n      status = offsetHeight >= scrollHeight ? '00' : '01';\n    } else if (scrollTop + offsetHeight >= scrollHeight) {\n      status = '10';\n    }\n    if (status !== '11' && touch.isVertical() && !(parseInt(status, 2) & parseInt(direction, 2))) {\n      if (event.cancelable) {\n        event.preventDefault();\n      }\n    }\n  };\n  const lock = () => {\n    document.addEventListener('touchstart', touch.start);\n    document.addEventListener('touchmove', onTouchMove, supportsPassive ? {\n      passive: false\n    } : false);\n    if (!totalLockCount) {\n      document.body.classList.add(BODY_LOCK_CLASS);\n    }\n    totalLockCount++;\n  };\n  const unlock = () => {\n    if (totalLockCount) {\n      document.removeEventListener('touchstart', touch.start);\n      document.removeEventListener('touchmove', onTouchMove);\n      totalLockCount--;\n      if (!totalLockCount) {\n        document.body.classList.remove(BODY_LOCK_CLASS);\n      }\n    }\n  };\n  useEffect(() => {\n    if (shouldLock) {\n      lock();\n      return () => {\n        unlock();\n      };\n    }\n  }, [shouldLock]);\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}