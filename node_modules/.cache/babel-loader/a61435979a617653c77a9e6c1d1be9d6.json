{"ast":null,"code":"import { useClickAway } from 'ahooks';\nimport classNames from 'classnames';\nimport React, { cloneElement, useEffect, useRef, useState, forwardRef, useImperativeHandle } from 'react';\nimport Popup from '../popup';\nimport { ItemChildrenWrap } from './item';\nimport { withNativeProps } from '../../utils/native-props';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { usePropsValue } from '../../utils/use-props-value';\nconst classPrefix = `adm-dropdown`;\nconst defaultProps = {\n  defaultActiveKey: null,\n  closeOnMaskClick: true,\n  closeOnClickAway: false\n};\nconst Dropdown = forwardRef((p, ref) => {\n  const props = mergeProps(defaultProps, p);\n  const [value, setValue] = usePropsValue({\n    value: props.activeKey,\n    defaultValue: props.defaultActiveKey,\n    onChange: props.onChange\n  });\n  const navRef = useRef(null);\n  const contentRef = useRef(null); // 点击外部区域，关闭\n\n  useClickAway(() => {\n    if (!props.closeOnClickAway) return;\n    setValue(null);\n  }, [navRef, contentRef]); // 计算 navs 的 top 值\n\n  const [top, setTop] = useState();\n  const containerRef = useRef(null);\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) return;\n\n    if (value) {\n      const rect = container.getBoundingClientRect();\n      setTop(rect.bottom);\n    }\n  }, [value]);\n\n  const changeActive = key => {\n    if (value === key) {\n      setValue(null);\n    } else {\n      setValue(key);\n    }\n  };\n\n  let popupForceRender = false;\n  const items = [];\n  const navs = React.Children.map(props.children, child => {\n    if (React.isValidElement(child)) {\n      const childProps = Object.assign(Object.assign({}, child.props), {\n        onClick: () => {\n          changeActive(child.key);\n        },\n        active: child.key === value,\n        arrow: child.props.arrow === undefined ? props.arrow : child.props.arrow\n      });\n      items.push(child);\n      if (child.props.forceRender) popupForceRender = true;\n      return cloneElement(child, childProps);\n    } else {\n      return child;\n    }\n  });\n  useImperativeHandle(ref, () => ({\n    close: () => {\n      setValue(null);\n    }\n  }), [setValue]);\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classNames(classPrefix, {\n      [`${classPrefix}-open`]: !!value\n    }),\n    ref: containerRef\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-nav`,\n    ref: navRef\n  }, navs), React.createElement(Popup, {\n    visible: !!value,\n    position: 'top',\n    className: `${classPrefix}-popup`,\n    maskClassName: `${classPrefix}-popup-mask`,\n    bodyClassName: `${classPrefix}-popup-body`,\n    style: {\n      top\n    },\n    forceRender: popupForceRender,\n    onMaskClick: props.closeOnMaskClick ? () => {\n      changeActive(null);\n    } : undefined\n  }, React.createElement(\"div\", {\n    ref: contentRef\n  }, items.map(item => {\n    const isActive = item.key === value;\n    return React.createElement(ItemChildrenWrap, {\n      key: item.key,\n      active: isActive,\n      forceRender: item.props.forceRender,\n      destroyOnClose: item.props.destroyOnClose\n    }, item.props.children);\n  })))));\n});\nexport default Dropdown;","map":{"version":3,"names":["useClickAway","classNames","React","cloneElement","useEffect","useRef","useState","forwardRef","useImperativeHandle","Popup","ItemChildrenWrap","withNativeProps","mergeProps","usePropsValue","classPrefix","defaultProps","defaultActiveKey","closeOnMaskClick","closeOnClickAway","Dropdown","p","ref","props","value","setValue","activeKey","defaultValue","onChange","navRef","contentRef","top","setTop","containerRef","container","current","rect","getBoundingClientRect","bottom","changeActive","key","popupForceRender","items","navs","Children","map","children","child","isValidElement","childProps","Object","assign","onClick","active","arrow","undefined","push","forceRender","close","createElement","className","visible","position","maskClassName","bodyClassName","style","onMaskClick","item","isActive","destroyOnClose"],"sources":["/Users/tonystark/code/VSCodeProject/react/gk-h5/node_modules/antd-mobile/es/components/dropdown/dropdown.js"],"sourcesContent":["import { useClickAway } from 'ahooks';\nimport classNames from 'classnames';\nimport React, { cloneElement, useEffect, useRef, useState, forwardRef, useImperativeHandle } from 'react';\nimport Popup from '../popup';\nimport { ItemChildrenWrap } from './item';\nimport { withNativeProps } from '../../utils/native-props';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { usePropsValue } from '../../utils/use-props-value';\nconst classPrefix = `adm-dropdown`;\nconst defaultProps = {\n  defaultActiveKey: null,\n  closeOnMaskClick: true,\n  closeOnClickAway: false\n};\nconst Dropdown = forwardRef((p, ref) => {\n  const props = mergeProps(defaultProps, p);\n  const [value, setValue] = usePropsValue({\n    value: props.activeKey,\n    defaultValue: props.defaultActiveKey,\n    onChange: props.onChange\n  });\n  const navRef = useRef(null);\n  const contentRef = useRef(null); // 点击外部区域，关闭\n\n  useClickAway(() => {\n    if (!props.closeOnClickAway) return;\n    setValue(null);\n  }, [navRef, contentRef]); // 计算 navs 的 top 值\n\n  const [top, setTop] = useState();\n  const containerRef = useRef(null);\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) return;\n\n    if (value) {\n      const rect = container.getBoundingClientRect();\n      setTop(rect.bottom);\n    }\n  }, [value]);\n\n  const changeActive = key => {\n    if (value === key) {\n      setValue(null);\n    } else {\n      setValue(key);\n    }\n  };\n\n  let popupForceRender = false;\n  const items = [];\n  const navs = React.Children.map(props.children, child => {\n    if (React.isValidElement(child)) {\n      const childProps = Object.assign(Object.assign({}, child.props), {\n        onClick: () => {\n          changeActive(child.key);\n        },\n        active: child.key === value,\n        arrow: child.props.arrow === undefined ? props.arrow : child.props.arrow\n      });\n      items.push(child);\n      if (child.props.forceRender) popupForceRender = true;\n      return cloneElement(child, childProps);\n    } else {\n      return child;\n    }\n  });\n  useImperativeHandle(ref, () => ({\n    close: () => {\n      setValue(null);\n    }\n  }), [setValue]);\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classNames(classPrefix, {\n      [`${classPrefix}-open`]: !!value\n    }),\n    ref: containerRef\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-nav`,\n    ref: navRef\n  }, navs), React.createElement(Popup, {\n    visible: !!value,\n    position: 'top',\n    className: `${classPrefix}-popup`,\n    maskClassName: `${classPrefix}-popup-mask`,\n    bodyClassName: `${classPrefix}-popup-body`,\n    style: {\n      top\n    },\n    forceRender: popupForceRender,\n    onMaskClick: props.closeOnMaskClick ? () => {\n      changeActive(null);\n    } : undefined\n  }, React.createElement(\"div\", {\n    ref: contentRef\n  }, items.map(item => {\n    const isActive = item.key === value;\n    return React.createElement(ItemChildrenWrap, {\n      key: item.key,\n      active: isActive,\n      forceRender: item.props.forceRender,\n      destroyOnClose: item.props.destroyOnClose\n    }, item.props.children);\n  })))));\n});\nexport default Dropdown;"],"mappings":"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"},"metadata":{},"sourceType":"module"}