{"ast":null,"code":"import { mergeProps } from '../../utils/with-default-props';\nimport React, { useState, useRef } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport { staged } from 'staged-components';\nimport { toCSSLength } from '../../utils/to-css-length';\nimport { LazyDetector } from './lazy-detector';\nimport { useIsomorphicUpdateLayoutEffect } from '../../utils/use-isomorphic-update-layout-effect';\nimport { ImageIcon } from './image-icon';\nimport { BrokenImageIcon } from './broken-image-icon';\nconst classPrefix = `adm-image`;\nconst defaultProps = {\n  fit: 'fill',\n  placeholder: React.createElement(\"div\", {\n    className: `${classPrefix}-tip`\n  }, React.createElement(ImageIcon, null)),\n  fallback: React.createElement(\"div\", {\n    className: `${classPrefix}-tip`\n  }, React.createElement(BrokenImageIcon, null)),\n  lazy: false,\n  draggable: false\n};\nexport const Image = staged(p => {\n  const props = mergeProps(defaultProps, p);\n  const [loaded, setLoaded] = useState(false);\n  const [failed, setFailed] = useState(false);\n  const ref = useRef(null);\n  let src = props.src;\n  let srcSet = props.srcSet;\n  const [initialized, setInitialized] = useState(!props.lazy);\n  src = initialized ? props.src : undefined;\n  srcSet = initialized ? props.srcSet : undefined;\n  useIsomorphicUpdateLayoutEffect(() => {\n    setLoaded(false);\n    setFailed(false);\n  }, [src]);\n\n  function renderInner() {\n    if (failed) {\n      return React.createElement(React.Fragment, null, props.fallback);\n    }\n\n    const img = React.createElement(\"img\", {\n      className: `${classPrefix}-img`,\n      src: src,\n      alt: props.alt,\n      onClick: props.onClick,\n      onLoad: e => {\n        var _a;\n\n        setLoaded(true);\n        (_a = props.onLoad) === null || _a === void 0 ? void 0 : _a.call(props, e);\n      },\n      onError: e => {\n        var _a;\n\n        setFailed(true);\n        (_a = props.onError) === null || _a === void 0 ? void 0 : _a.call(props, e);\n      },\n      style: {\n        objectFit: props.fit,\n        display: loaded ? 'block' : 'none'\n      },\n      crossOrigin: props.crossOrigin,\n      decoding: props.decoding,\n      loading: props.loading,\n      referrerPolicy: props.referrerPolicy,\n      sizes: props.sizes,\n      srcSet: srcSet,\n      useMap: props.useMap,\n      draggable: props.draggable\n    });\n    return React.createElement(React.Fragment, null, !loaded && props.placeholder, img);\n  }\n\n  const style = {};\n\n  if (props.width) {\n    style['--width'] = toCSSLength(props.width);\n    style['width'] = toCSSLength(props.width);\n  }\n\n  if (props.height) {\n    style['--height'] = toCSSLength(props.height);\n    style['height'] = toCSSLength(props.height);\n  }\n\n  return withNativeProps(props, React.createElement(\"div\", {\n    ref: ref,\n    className: classPrefix,\n    style: style,\n    onClick: props.onContainerClick\n  }, props.lazy && !initialized && React.createElement(LazyDetector, {\n    onActive: () => {\n      setInitialized(true);\n    }\n  }), renderInner()));\n});","map":{"version":3,"names":["mergeProps","React","useState","useRef","withNativeProps","staged","toCSSLength","LazyDetector","useIsomorphicUpdateLayoutEffect","ImageIcon","BrokenImageIcon","classPrefix","defaultProps","fit","placeholder","createElement","className","fallback","lazy","draggable","Image","p","props","loaded","setLoaded","failed","setFailed","ref","src","srcSet","initialized","setInitialized","undefined","renderInner","Fragment","img","alt","onClick","onLoad","e","_a","call","onError","style","objectFit","display","crossOrigin","decoding","loading","referrerPolicy","sizes","useMap","width","height","onContainerClick","onActive"],"sources":["/Users/tonystark/code/VSCodeProject/react/gk-h5/node_modules/antd-mobile/es/components/image/image.js"],"sourcesContent":["import { mergeProps } from '../../utils/with-default-props';\nimport React, { useState, useRef } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport { staged } from 'staged-components';\nimport { toCSSLength } from '../../utils/to-css-length';\nimport { LazyDetector } from './lazy-detector';\nimport { useIsomorphicUpdateLayoutEffect } from '../../utils/use-isomorphic-update-layout-effect';\nimport { ImageIcon } from './image-icon';\nimport { BrokenImageIcon } from './broken-image-icon';\nconst classPrefix = `adm-image`;\nconst defaultProps = {\n  fit: 'fill',\n  placeholder: React.createElement(\"div\", {\n    className: `${classPrefix}-tip`\n  }, React.createElement(ImageIcon, null)),\n  fallback: React.createElement(\"div\", {\n    className: `${classPrefix}-tip`\n  }, React.createElement(BrokenImageIcon, null)),\n  lazy: false,\n  draggable: false\n};\nexport const Image = staged(p => {\n  const props = mergeProps(defaultProps, p);\n  const [loaded, setLoaded] = useState(false);\n  const [failed, setFailed] = useState(false);\n  const ref = useRef(null);\n  let src = props.src;\n  let srcSet = props.srcSet;\n  const [initialized, setInitialized] = useState(!props.lazy);\n  src = initialized ? props.src : undefined;\n  srcSet = initialized ? props.srcSet : undefined;\n  useIsomorphicUpdateLayoutEffect(() => {\n    setLoaded(false);\n    setFailed(false);\n  }, [src]);\n\n  function renderInner() {\n    if (failed) {\n      return React.createElement(React.Fragment, null, props.fallback);\n    }\n\n    const img = React.createElement(\"img\", {\n      className: `${classPrefix}-img`,\n      src: src,\n      alt: props.alt,\n      onClick: props.onClick,\n      onLoad: e => {\n        var _a;\n\n        setLoaded(true);\n        (_a = props.onLoad) === null || _a === void 0 ? void 0 : _a.call(props, e);\n      },\n      onError: e => {\n        var _a;\n\n        setFailed(true);\n        (_a = props.onError) === null || _a === void 0 ? void 0 : _a.call(props, e);\n      },\n      style: {\n        objectFit: props.fit,\n        display: loaded ? 'block' : 'none'\n      },\n      crossOrigin: props.crossOrigin,\n      decoding: props.decoding,\n      loading: props.loading,\n      referrerPolicy: props.referrerPolicy,\n      sizes: props.sizes,\n      srcSet: srcSet,\n      useMap: props.useMap,\n      draggable: props.draggable\n    });\n    return React.createElement(React.Fragment, null, !loaded && props.placeholder, img);\n  }\n\n  const style = {};\n\n  if (props.width) {\n    style['--width'] = toCSSLength(props.width);\n    style['width'] = toCSSLength(props.width);\n  }\n\n  if (props.height) {\n    style['--height'] = toCSSLength(props.height);\n    style['height'] = toCSSLength(props.height);\n  }\n\n  return withNativeProps(props, React.createElement(\"div\", {\n    ref: ref,\n    className: classPrefix,\n    style: style,\n    onClick: props.onContainerClick\n  }, props.lazy && !initialized && React.createElement(LazyDetector, {\n    onActive: () => {\n      setInitialized(true);\n    }\n  }), renderInner()));\n});"],"mappings":"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"},"metadata":{},"sourceType":"module"}