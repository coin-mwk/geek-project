{"ast":null,"code":"import React, { useState, useEffect, useRef, forwardRef, useImperativeHandle } from 'react';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { withNativeProps } from '../../utils/native-props';\nimport classNames from 'classnames';\nimport { bound } from '../../utils/bound';\nimport { usePropsValue } from '../../utils/use-props-value';\nimport { useConfig } from '../config-provider';\nconst classPrefix = 'adm-passcode-input';\nconst defaultProps = {\n  defaultValue: '',\n  length: 6,\n  plain: false,\n  error: false,\n  seperated: false,\n  caret: true\n};\nexport const PasscodeInput = forwardRef((p, ref) => {\n  const props = mergeProps(defaultProps, p); // 防止 length 值不合法\n\n  const cellLength = props.length > 0 && props.length < Infinity ? Math.floor(props.length) : defaultProps.length;\n  const {\n    locale\n  } = useConfig();\n  const [focused, setFocused] = useState(false);\n  const [value, setValue] = usePropsValue(props);\n  const rootRef = useRef(null);\n  const nativeInputRef = useRef(null);\n  useEffect(() => {\n    var _a;\n\n    if (value.length >= cellLength) {\n      (_a = props.onFill) === null || _a === void 0 ? void 0 : _a.call(props, value);\n    }\n  }, [value, cellLength]);\n\n  const onFocus = () => {\n    var _a, _b;\n\n    if (!props.keyboard) {\n      (_a = nativeInputRef.current) === null || _a === void 0 ? void 0 : _a.focus();\n    }\n\n    setFocused(true);\n    (_b = props.onFocus) === null || _b === void 0 ? void 0 : _b.call(props);\n  };\n\n  useEffect(() => {\n    if (!focused) return;\n    const timeout = window.setTimeout(() => {\n      var _a;\n\n      (_a = rootRef.current) === null || _a === void 0 ? void 0 : _a.scrollIntoView({\n        block: 'center',\n        inline: 'center',\n        behavior: 'smooth'\n      });\n    }, 100);\n    return () => {\n      window.clearTimeout(timeout);\n    };\n  }, [focused]);\n\n  const onBlur = () => {\n    var _a;\n\n    setFocused(false);\n    (_a = props.onBlur) === null || _a === void 0 ? void 0 : _a.call(props);\n  };\n\n  useImperativeHandle(ref, () => ({\n    focus: () => {\n      var _a;\n\n      return (_a = rootRef.current) === null || _a === void 0 ? void 0 : _a.focus();\n    },\n    blur: () => {\n      var _a, _b;\n\n      (_a = rootRef.current) === null || _a === void 0 ? void 0 : _a.blur();\n      (_b = nativeInputRef.current) === null || _b === void 0 ? void 0 : _b.blur();\n    }\n  }));\n\n  const renderCells = () => {\n    const cells = [];\n    const chars = value.split('');\n    const caretIndex = chars.length; // 光标位置index等于当前文字长度\n\n    const focusedIndex = bound(chars.length, 0, cellLength - 1);\n\n    for (let i = 0; i < cellLength; i++) {\n      cells.push(React.createElement(\"div\", {\n        className: classNames(`${classPrefix}-cell`, {\n          [`${classPrefix}-cell-caret`]: props.caret && caretIndex === i && focused,\n          [`${classPrefix}-cell-focused`]: focusedIndex === i && focused,\n          [`${classPrefix}-cell-dot`]: !props.plain && chars[i]\n        }),\n        key: i\n      }, chars[i] && props.plain ? chars[i] : ''));\n    }\n\n    return cells;\n  };\n\n  const cls = classNames(classPrefix, {\n    [`${classPrefix}-focused`]: focused,\n    [`${classPrefix}-error`]: props.error,\n    [`${classPrefix}-seperated`]: props.seperated\n  });\n  return React.createElement(React.Fragment, null, withNativeProps(props, React.createElement(\"div\", {\n    ref: rootRef,\n    tabIndex: 0,\n    className: cls,\n    onFocus: onFocus,\n    onBlur: onBlur,\n    role: 'button',\n    \"aria-label\": locale.PasscodeInput.name\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-cell-container`\n  }, renderCells()), React.createElement(\"input\", {\n    ref: nativeInputRef,\n    className: `${classPrefix}-native-input`,\n    value: value,\n    type: 'text',\n    pattern: '[0-9]*',\n    inputMode: 'numeric',\n    onChange: e => {\n      setValue(e.target.value.slice(0, props.length));\n    },\n    \"aria-hidden\": true\n  }))), props.keyboard && React.cloneElement(props.keyboard, {\n    visible: focused,\n    onInput: v => {\n      if (value.length < cellLength) {\n        setValue((value + v).slice(0, props.length));\n      }\n    },\n    onDelete: () => {\n      setValue(value.slice(0, -1));\n    },\n    onClose: () => {\n      var _a;\n\n      (_a = rootRef.current) === null || _a === void 0 ? void 0 : _a.blur();\n    }\n  }));\n});","map":{"version":3,"names":["React","useState","useEffect","useRef","forwardRef","useImperativeHandle","mergeProps","withNativeProps","classNames","bound","usePropsValue","useConfig","classPrefix","defaultProps","defaultValue","length","plain","error","seperated","caret","PasscodeInput","p","ref","props","cellLength","Infinity","Math","floor","locale","focused","setFocused","value","setValue","rootRef","nativeInputRef","_a","onFill","call","onFocus","_b","keyboard","current","focus","timeout","window","setTimeout","scrollIntoView","block","inline","behavior","clearTimeout","onBlur","blur","renderCells","cells","chars","split","caretIndex","focusedIndex","i","push","createElement","className","key","cls","Fragment","tabIndex","role","name","type","pattern","inputMode","onChange","e","target","slice","cloneElement","visible","onInput","v","onDelete","onClose"],"sources":["/Users/tonystark/code/VSCodeProject/react/gk-h5/node_modules/antd-mobile/es/components/passcode-input/passcode-input.js"],"sourcesContent":["import React, { useState, useEffect, useRef, forwardRef, useImperativeHandle } from 'react';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { withNativeProps } from '../../utils/native-props';\nimport classNames from 'classnames';\nimport { bound } from '../../utils/bound';\nimport { usePropsValue } from '../../utils/use-props-value';\nimport { useConfig } from '../config-provider';\nconst classPrefix = 'adm-passcode-input';\nconst defaultProps = {\n  defaultValue: '',\n  length: 6,\n  plain: false,\n  error: false,\n  seperated: false,\n  caret: true\n};\nexport const PasscodeInput = forwardRef((p, ref) => {\n  const props = mergeProps(defaultProps, p); // 防止 length 值不合法\n\n  const cellLength = props.length > 0 && props.length < Infinity ? Math.floor(props.length) : defaultProps.length;\n  const {\n    locale\n  } = useConfig();\n  const [focused, setFocused] = useState(false);\n  const [value, setValue] = usePropsValue(props);\n  const rootRef = useRef(null);\n  const nativeInputRef = useRef(null);\n  useEffect(() => {\n    var _a;\n\n    if (value.length >= cellLength) {\n      (_a = props.onFill) === null || _a === void 0 ? void 0 : _a.call(props, value);\n    }\n  }, [value, cellLength]);\n\n  const onFocus = () => {\n    var _a, _b;\n\n    if (!props.keyboard) {\n      (_a = nativeInputRef.current) === null || _a === void 0 ? void 0 : _a.focus();\n    }\n\n    setFocused(true);\n    (_b = props.onFocus) === null || _b === void 0 ? void 0 : _b.call(props);\n  };\n\n  useEffect(() => {\n    if (!focused) return;\n    const timeout = window.setTimeout(() => {\n      var _a;\n\n      (_a = rootRef.current) === null || _a === void 0 ? void 0 : _a.scrollIntoView({\n        block: 'center',\n        inline: 'center',\n        behavior: 'smooth'\n      });\n    }, 100);\n    return () => {\n      window.clearTimeout(timeout);\n    };\n  }, [focused]);\n\n  const onBlur = () => {\n    var _a;\n\n    setFocused(false);\n    (_a = props.onBlur) === null || _a === void 0 ? void 0 : _a.call(props);\n  };\n\n  useImperativeHandle(ref, () => ({\n    focus: () => {\n      var _a;\n\n      return (_a = rootRef.current) === null || _a === void 0 ? void 0 : _a.focus();\n    },\n    blur: () => {\n      var _a, _b;\n\n      (_a = rootRef.current) === null || _a === void 0 ? void 0 : _a.blur();\n      (_b = nativeInputRef.current) === null || _b === void 0 ? void 0 : _b.blur();\n    }\n  }));\n\n  const renderCells = () => {\n    const cells = [];\n    const chars = value.split('');\n    const caretIndex = chars.length; // 光标位置index等于当前文字长度\n\n    const focusedIndex = bound(chars.length, 0, cellLength - 1);\n\n    for (let i = 0; i < cellLength; i++) {\n      cells.push(React.createElement(\"div\", {\n        className: classNames(`${classPrefix}-cell`, {\n          [`${classPrefix}-cell-caret`]: props.caret && caretIndex === i && focused,\n          [`${classPrefix}-cell-focused`]: focusedIndex === i && focused,\n          [`${classPrefix}-cell-dot`]: !props.plain && chars[i]\n        }),\n        key: i\n      }, chars[i] && props.plain ? chars[i] : ''));\n    }\n\n    return cells;\n  };\n\n  const cls = classNames(classPrefix, {\n    [`${classPrefix}-focused`]: focused,\n    [`${classPrefix}-error`]: props.error,\n    [`${classPrefix}-seperated`]: props.seperated\n  });\n  return React.createElement(React.Fragment, null, withNativeProps(props, React.createElement(\"div\", {\n    ref: rootRef,\n    tabIndex: 0,\n    className: cls,\n    onFocus: onFocus,\n    onBlur: onBlur,\n    role: 'button',\n    \"aria-label\": locale.PasscodeInput.name\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-cell-container`\n  }, renderCells()), React.createElement(\"input\", {\n    ref: nativeInputRef,\n    className: `${classPrefix}-native-input`,\n    value: value,\n    type: 'text',\n    pattern: '[0-9]*',\n    inputMode: 'numeric',\n    onChange: e => {\n      setValue(e.target.value.slice(0, props.length));\n    },\n    \"aria-hidden\": true\n  }))), props.keyboard && React.cloneElement(props.keyboard, {\n    visible: focused,\n    onInput: v => {\n      if (value.length < cellLength) {\n        setValue((value + v).slice(0, props.length));\n      }\n    },\n    onDelete: () => {\n      setValue(value.slice(0, -1));\n    },\n    onClose: () => {\n      var _a;\n\n      (_a = rootRef.current) === null || _a === void 0 ? void 0 : _a.blur();\n    }\n  }));\n});"],"mappings":"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"},"metadata":{},"sourceType":"module"}