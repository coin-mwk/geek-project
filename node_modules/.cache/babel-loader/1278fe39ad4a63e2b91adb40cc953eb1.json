{"ast":null,"code":"import classNames from 'classnames';\nimport React, { useEffect, useState } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport { mergeProps } from '../../utils/with-default-props';\nconst classPrefix = `adm-water-mark`;\nconst defaultProps = {\n  fullPage: true\n};\nexport const WaterMark = p => {\n  const props = mergeProps(defaultProps, p);\n  const {\n    zIndex = 2000,\n    gapX = 24,\n    gapY = 48,\n    width = 120,\n    height = 64,\n    rotate = -22,\n    image,\n    imageWidth = 120,\n    imageHeight = 64,\n    content,\n    fontStyle = 'normal',\n    fontWeight = 'normal',\n    fontColor = 'rgba(0,0,0,.15)',\n    fontSize = 14,\n    fontFamily = 'sans-serif'\n  } = props;\n  const [base64Url, setBase64Url] = useState('');\n  useEffect(() => {\n    const canvas = document.createElement('canvas');\n    const ratio = window.devicePixelRatio;\n    const ctx = canvas.getContext('2d');\n    const canvasWidth = `${(gapX + width) * ratio}px`;\n    const canvasHeight = `${(gapY + height) * ratio}px`;\n    const markWidth = width * ratio;\n    const markHeight = height * ratio;\n    canvas.setAttribute('width', canvasWidth);\n    canvas.setAttribute('height', canvasHeight);\n\n    if (ctx) {\n      if (image) {\n        ctx.translate(markWidth / 2, markHeight / 2);\n        ctx.rotate(Math.PI / 180 * Number(rotate));\n        const img = new Image();\n        img.crossOrigin = 'anonymous';\n        img.referrerPolicy = 'no-referrer';\n\n        img.onload = () => {\n          ctx.drawImage(img, -imageWidth * ratio / 2, -imageHeight * ratio / 2, imageWidth * ratio, imageHeight * ratio);\n          ctx.restore();\n          setBase64Url(canvas.toDataURL());\n        };\n\n        img.src = image;\n      } else if (content) {\n        ctx.textBaseline = 'middle';\n        ctx.textAlign = 'center'; // 文字绕中间旋转\n\n        ctx.translate(markWidth / 2, markHeight / 2);\n        ctx.rotate(Math.PI / 180 * Number(rotate));\n        const markSize = Number(fontSize) * ratio;\n        ctx.font = `${fontStyle} normal ${fontWeight} ${markSize}px/${markHeight}px ${fontFamily}`;\n        ctx.fillStyle = fontColor;\n        ctx.fillText(content, 0, 0);\n        ctx.restore();\n        setBase64Url(canvas.toDataURL());\n      }\n    } else {\n      throw new Error('Canvas is not supported in the current environment');\n    }\n  }, [gapX, gapY, rotate, fontStyle, fontWeight, width, height, fontFamily, fontColor, image, content, fontSize]);\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classNames(classPrefix, {\n      [`${classPrefix}-full-page`]: props.fullPage\n    }),\n    style: {\n      zIndex,\n      backgroundSize: `${gapX + width}px`,\n      backgroundImage: `url('${base64Url}')`\n    }\n  }));\n};","map":{"version":3,"names":["classNames","React","useEffect","useState","withNativeProps","mergeProps","classPrefix","defaultProps","fullPage","WaterMark","p","props","zIndex","gapX","gapY","width","height","rotate","image","imageWidth","imageHeight","content","fontStyle","fontWeight","fontColor","fontSize","fontFamily","base64Url","setBase64Url","canvas","document","createElement","ratio","window","devicePixelRatio","ctx","getContext","canvasWidth","canvasHeight","markWidth","markHeight","setAttribute","translate","Math","PI","Number","img","Image","crossOrigin","referrerPolicy","onload","drawImage","restore","toDataURL","src","textBaseline","textAlign","markSize","font","fillStyle","fillText","Error","className","style","backgroundSize","backgroundImage"],"sources":["/Users/tonystark/code/VSCodeProject/react/gk-h5/node_modules/antd-mobile/es/components/water-mark/water-mark.js"],"sourcesContent":["import classNames from 'classnames';\nimport React, { useEffect, useState } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport { mergeProps } from '../../utils/with-default-props';\nconst classPrefix = `adm-water-mark`;\nconst defaultProps = {\n  fullPage: true\n};\nexport const WaterMark = p => {\n  const props = mergeProps(defaultProps, p);\n  const {\n    zIndex = 2000,\n    gapX = 24,\n    gapY = 48,\n    width = 120,\n    height = 64,\n    rotate = -22,\n    image,\n    imageWidth = 120,\n    imageHeight = 64,\n    content,\n    fontStyle = 'normal',\n    fontWeight = 'normal',\n    fontColor = 'rgba(0,0,0,.15)',\n    fontSize = 14,\n    fontFamily = 'sans-serif'\n  } = props;\n  const [base64Url, setBase64Url] = useState('');\n  useEffect(() => {\n    const canvas = document.createElement('canvas');\n    const ratio = window.devicePixelRatio;\n    const ctx = canvas.getContext('2d');\n    const canvasWidth = `${(gapX + width) * ratio}px`;\n    const canvasHeight = `${(gapY + height) * ratio}px`;\n    const markWidth = width * ratio;\n    const markHeight = height * ratio;\n    canvas.setAttribute('width', canvasWidth);\n    canvas.setAttribute('height', canvasHeight);\n    if (ctx) {\n      if (image) {\n        ctx.translate(markWidth / 2, markHeight / 2);\n        ctx.rotate(Math.PI / 180 * Number(rotate));\n        const img = new Image();\n        img.crossOrigin = 'anonymous';\n        img.referrerPolicy = 'no-referrer';\n        img.onload = () => {\n          ctx.drawImage(img, -imageWidth * ratio / 2, -imageHeight * ratio / 2, imageWidth * ratio, imageHeight * ratio);\n          ctx.restore();\n          setBase64Url(canvas.toDataURL());\n        };\n        img.src = image;\n      } else if (content) {\n        ctx.textBaseline = 'middle';\n        ctx.textAlign = 'center';\n        // 文字绕中间旋转\n        ctx.translate(markWidth / 2, markHeight / 2);\n        ctx.rotate(Math.PI / 180 * Number(rotate));\n        const markSize = Number(fontSize) * ratio;\n        ctx.font = `${fontStyle} normal ${fontWeight} ${markSize}px/${markHeight}px ${fontFamily}`;\n        ctx.fillStyle = fontColor;\n        ctx.fillText(content, 0, 0);\n        ctx.restore();\n        setBase64Url(canvas.toDataURL());\n      }\n    } else {\n      throw new Error('Canvas is not supported in the current environment');\n    }\n  }, [gapX, gapY, rotate, fontStyle, fontWeight, width, height, fontFamily, fontColor, image, content, fontSize]);\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classNames(classPrefix, {\n      [`${classPrefix}-full-page`]: props.fullPage\n    }),\n    style: {\n      zIndex,\n      backgroundSize: `${gapX + width}px`,\n      backgroundImage: `url('${base64Url}')`\n    }\n  }));\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}